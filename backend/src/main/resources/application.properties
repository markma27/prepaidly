server.port=${PORT:8080}
spring.application.name=prepaidly-backend

# Database Configuration
# Supports both local PostgreSQL and Supabase
# For Supabase: Get connection string from https://supabase.com/dashboard
# Supabase requires SSL - add ?sslmode=require to connection URL
# IMPORTANT: Supabase uses connection pooling (pgBouncer) which doesn't support prepared statements
# Add prepareThreshold=0 to disable prepared statements for Supabase
# Example: jdbc:postgresql://db.xxxxx.supabase.co:5432/postgres?sslmode=require&prepareThreshold=0
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/prepaidly}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection Pooling (important for Supabase)
# Supabase free tier has connection limits, so keep pool size small
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# JPA Configuration
# Use 'update' for development to auto-create tables, 'validate' for production
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
spring.jpa.open-in-view=false
# Fix for connection pooler autoCommit issue - don't try to disable autocommit
# The pooler uses Transaction mode which has autoCommit enabled
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=false
spring.jpa.properties.hibernate.connection.handling_mode=delayed_acquisition_and_release_after_transaction

# JWT Configuration
jwt.secret=${JWT_SECRET:changeme-in-production}
jwt.expiration=86400000

# Encryption
# IMPORTANT: Set this via environment variable in production!
jasypt.encryptor.password=${JASYPT_PASSWORD:changeme-in-production}
jasypt.encryptor.algorithm=PBEWithMD5AndDES

# Sentry Configuration
sentry.dsn=${SENTRY_DSN:}
sentry.environment=${SENTRY_ENV:development}

# Logging
logging.level.com.prepaidly=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n

