# Prepaidly 前端快速启动指南

## 前置要求

1. ✅ 后端已配置并运行在 `http://localhost:8080`
2. ✅ Supabase 数据库已配置并运行了 schema
3. ✅ Xero OAuth2 凭据已配置（`application-local.properties`）
4. ✅ Node.js 18+ 已安装

## 快速启动步骤

### 1. 安装前端依赖

```bash
cd frontend
npm install
```

### 2. 启动前端开发服务器

```bash
npm run dev
```

前端将在 `http://localhost:3000` 启动。

### 3. 验证后端连接

打开浏览器访问 `http://localhost:3000`，应该能看到主页。

### 4. 连接 Xero

1. 点击 "开始使用" 或访问 `http://localhost:3000/app`
2. 点击 "连接到 Xero" 按钮
3. 在 Xero 登录页面：
   - 使用您的 Xero 账户登录
   - **重要：选择 Demo Company**
   - 授权应用访问
4. 授权成功后，您将被重定向回应用

### 5. 创建第一个计划

1. 在连接成功页面，点击 "创建新计划"
2. 填写表单：
   - **计划类型**: 选择 "预付款费用" 或 "未实现收入"
   - **开始日期**: 例如 `2024-01-01`
   - **结束日期**: 例如 `2024-12-31`
   - **总金额**: 例如 `12000.00`
   - **账户选择**: 从下拉列表中选择相应的账户
3. 点击 "创建计划"

系统会自动生成月度摊销日记账条目。

### 6. 推送日记账到 Xero

1. 在仪表板页面查看所有计划
2. 找到未发布的日记账条目
3. 点击 "推送到 Xero" 按钮
4. 确认后，日记账将被推送到 Xero

## 测试清单

### ✅ 连接测试
- [ ] 能够访问主页
- [ ] 能够点击连接到 Xero
- [ ] OAuth 流程成功完成
- [ ] 连接成功后显示租户信息

### ✅ 账户列表测试
- [ ] 连接后自动加载账户列表
- [ ] 账户列表正确显示（代码、名称、类型）
- [ ] 系统账户和已归档账户被过滤

### ✅ 创建计划测试
- [ ] 能够选择计划类型
- [ ] 日期选择器正常工作
- [ ] 账户下拉列表正确过滤
- [ ] 表单验证正常工作
- [ ] 计划创建成功

### ✅ 仪表板测试
- [ ] 显示所有计划
- [ ] 显示计划详细信息
- [ ] 显示日记账条目列表
- [ ] 显示发布状态

### ✅ 推送日记账测试
- [ ] 能够点击推送按钮
- [ ] 推送成功后状态更新
- [ ] Xero 日记账 ID 正确显示

## 常见问题

### 问题：CORS 错误

**解决方案**: 确保后端 `WebConfig.java` 中配置了 `http://localhost:3000` 作为允许的来源。

### 问题：API 连接失败

**检查清单**:
1. 后端是否在 `http://localhost:8080` 运行？
2. 浏览器控制台是否有错误？
3. 网络请求是否返回 404 或 500？

### 问题：账户列表为空

**可能原因**:
1. Xero Demo Company 中没有账户数据
2. API 调用失败
3. 所有账户都被过滤掉了（系统账户或已归档）

**解决方案**: 检查浏览器控制台的网络请求和响应。

### 问题：创建计划失败

**检查清单**:
1. 所有必填字段是否已填写？
2. 日期范围是否有效（开始日期 < 结束日期）？
3. 金额是否大于 0？
4. 账户是否已选择？

### 问题：推送日记账失败

**可能原因**:
1. Xero token 已过期
2. 账户代码无效
3. Xero API 限制

**解决方案**: 检查后端日志，查看具体错误信息。

## 开发提示

### 查看 API 请求

打开浏览器开发者工具（F12）：
- **Network** 标签：查看所有 API 请求
- **Console** 标签：查看错误和日志

### 调试模式

前端代码中包含 `console.error` 和 `console.log` 用于调试。在生产环境中应该移除或使用日志库。

### 环境变量

如果需要更改后端 URL，创建 `.env.local` 文件：

```env
NEXT_PUBLIC_API_URL=http://localhost:8080
```

## 下一步

1. ✅ 完成基本功能测试
2. 🔄 添加错误边界组件
3. 🔄 添加加载状态优化
4. 🔄 添加数据刷新功能
5. 🔄 优化移动端响应式设计

